<%- include('./partials/header') %>

<div class="container mt-5">
  <h1 class="mb-4">My Appointments</h1>

  <% if (appointments.length === 0) { %>
  <div class="alert alert-info">
    You have no appointments scheduled.
    <a href="/check-up">Book a check-up now!</a>
  </div>
  <% } else { %>
  <div class="card shadow-sm">
    <div class="card-body">
      <table class="table table-hover">
        <thead class="thead-light">
          <tr>
            <th>#</th>
            <th>Doctor</th>
            <th>Reason (Disease)</th>
            <th>Date</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <% appointments.forEach((appointment, index) => { %>
          <tr>
            <td><%= index + 1 %></td>
            <td>Dr. <%= appointment.Doctor.User.username %></td>
            <td><%= appointment.Disease ? appointment.Disease.name : '-' %></td>
            <td>
              <%= appointment.appointmentDate.toLocaleDateString('id-ID', {
              weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })
              %>
            </td>
            <td>
              <span
                class="badge badge-<%= appointment.status === 'pending' ? 'warning' : (appointment.status === 'completed' ? 'success' : 'danger') %>"
              >
                <%= appointment.status.charAt(0).toUpperCase() +
                appointment.status.slice(1) %>
              </span>
            </td>
            <td>
              <% if (appointment.status === 'pending') { %>
              <a
                href="/appointments/<%= appointment.id %>/cancel"
                class="btn btn-sm btn-danger"
                onclick="return confirm('Are you sure you want to cancel this appointment?')"
                >Cancel</a
              >
              <a
                href="/appointments/<%= appointment.id %>/invoice"
                class="btn btn-sm btn-info"
                >Invoice</a
              >
              <% } else if (appointment.status === 'completed') { %>
              <a
                href="/appointments/<%= appointment.id %>/invoice"
                class="btn btn-sm btn-info"
                >Invoice</a
              >
              <% } %>
            </td>
          </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
  </div>
  <% } %>

  <div class="mt-3">
    <a href="/" class="btn btn-secondary">Back to Home</a>
  </div>
</div>

<%- include('./partials/footer') %>
